{% extends 'base.html' %}
{% load static %}

{% block title %}Mening Kurslarim - ERP Sistema{% endblock %}

{% block page_title %}Mening Kurslarim{% endblock %}

{% block breadcrumb %}
<a href="{% url 'home' %}" class="text-decoration-none text-muted">Bosh sahifa</a> / 
<a href="{% url 'student:dashboard' %}" class="text-decoration-none text-muted">Dashboard</a> / 
<span>Kurslar</span>
{% endblock %}

{% block extra_css %}
<style>
    .course-card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        transition: all 0.3s;
        box-shadow: 0 2px 15px rgba(0,0,0,0.08);
    }
    
    .course-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .course-header {
        height: 200px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    
    .course-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: rgba(255,255,255,0.1);
        transform: rotate(45deg);
    }
    
    .course-header h3 {
        position: relative;
        z-index: 1;
        color: white;
        font-weight: bold;
        text-align: center;
        padding: 20px;
    }
    
    .course-body {
        padding: 25px;
    }
    
    .course-info-item {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .course-info-item i {
        font-size: 1.2rem;
        margin-right: 10px;
        color: #667eea;
    }
    
    .progress-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
    }
    
    .progress-custom {
        height: 10px;
        border-radius: 10px;
    }
    
    .level-badge {
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    .level-beginner {
        background: #d4edda;
        color: #155724;
    }
    
    .level-intermediate {
        background: #fff3cd;
        color: #856404;
    }
    
    .level-advanced {
        background: #f8d7da;
        color: #721c24;
    }
    
    .filter-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="bi bi-book"></i> Mening Kurslarim</h2>
        <p class="text-muted mb-0">Barcha faol kurslaringiz va ularning ma'lumotlari</p>
    </div>
</div>

<!-- Filters -->
<div class="filter-card">
    <div class="row align-items-center">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="searchCourse" placeholder="Kurs qidirish...">
            </div>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="filterLevel">
                <option value="">Barcha darajalar</option>
                <option value="beginner">Boshlang'ich</option>
                <option value="intermediate">O'rta</option>
                <option value="advanced">Ilg'or</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="filterStatus">
                <option value="">Barcha statuslar</option>
                <option value="active">Faol</option>
                <option value="completed">Tugallangan</option>
            </select>
        </div>
    </div>
</div>

<!-- Courses Grid -->
{% if courses %}
    <div class="row" id="coursesContainer">
        {% for course in courses %}
        <div class="col-lg-4 col-md-6 mb-4 course-item" 
             data-level="{{ course.level }}" 
             data-status="active">
            
            <div class="course-card h-100">
                
                <!-- Course Header -->
                <div class="course-header" style="background: linear-gradient(135deg, 
                    {% cycle '#667eea' '#f093fb' '#4facfe' '#43e97b' %} 0%, 
                    {% cycle '#764ba2' '#f5576c' '#00f2fe' '#38f9d7' %} 100%);">
                    <h3>{{ course.title }}</h3>
                </div>
                
                <!-- Course Body -->
                <div class="course-body">
                    
                    <!-- Description -->
                    <p class="text-muted mb-3">
                        {{ course.description|truncatewords:20 }}
                    </p>
                    
                    <!-- Course Info -->
                    <div class="course-info-item">
                        <i class="bi bi-calendar-week"></i>
                        <span>Davomiyligi: <strong>{{ course.duration_weeks }} hafta</strong></span>
                    </div>
                    
                    <div class="course-info-item">
                        <i class="bi bi-bar-chart-steps"></i>
                        <span>Daraja: 
                            <span class="level-badge level-{{ course.level }}">
                                {{ course.get_level_display }}
                            </span>
                        </span>
                    </div>
                    
                    <div class="course-info-item">
                        <i class="bi bi-cash"></i>
                        <span>Narxi: <strong>{{ course.price|floatformat:0 }} so'm</strong></span>
                    </div>
                    
                    <!-- Progress Section -->
                    <div class="progress-section">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="text-muted"><i class="bi bi-graph-up"></i> Davomiylik</small>
                            <strong class="text-primary">65%</strong>
                        </div>
                        <div class="progress progress-custom">
                            <div class="progress-bar bg-gradient" 
                                 style="width: 65%; background: linear-gradient(90deg, #667eea, #764ba2)">
                            </div>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <small class="text-muted">13/20 dars</small>
                            <small class="text-muted">7 dars qoldi</small>
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <div class="d-grid gap-2 mt-3">
                        <a href="{% url 'student:course_detail' course.pk %}" class="btn btn-primary">
                            <i class="bi bi-arrow-right-circle"></i> Kursga kirish
                        </a>
                    </div>
                    
                </div>
                
            </div>
            
        </div>
        {% endfor %}
    </div>
    
    <!-- Empty State (when filtered) -->
    <div id="emptyState" class="text-center py-5 d-none">
        <i class="bi bi-search" style="font-size: 4rem; color: #dee2e6;"></i>
        <h4 class="mt-3 text-muted">Hech narsa topilmadi</h4>
        <p class="text-muted">Iltimos, boshqa filtrlar bilan urinib ko'ring</p>
    </div>
    
{% else %}
    <!-- Empty State (no courses) -->
    <div class="text-center py-5">
        <i class="bi bi-inbox" style="font-size: 5rem; color: #dee2e6;"></i>
        <h3 class="mt-4 text-muted">Sizda hali kurslar yo'q</h3>
        <p class="text-muted">Siz hali hech qanday kursga yozilmagansiz</p>
        <a href="{% url 'student:dashboard' %}" class="btn btn-primary mt-3">
            <i class="bi bi-arrow-left"></i> Dashboardga qaytish
        </a>
    </div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    // Search and Filter Functionality
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchCourse');
        const levelFilter = document.getElementById('filterLevel');
        const statusFilter = document.getElementById('filterStatus');
        const courseItems = document.querySelectorAll('.course-item');
        const emptyState = document.getElementById('emptyState');
        const coursesContainer = document.getElementById('coursesContainer');
        
        function filterCourses() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedLevel = levelFilter.value;
            const selectedStatus = statusFilter.value;
            let visibleCount = 0;
            
            courseItems.forEach(item => {
                const courseText = item.textContent.toLowerCase();
                const courseLevel = item.getAttribute('data-level');
                const courseStatus = item.getAttribute('data-status');
                
                const matchesSearch = courseText.includes(searchTerm);
                const matchesLevel = !selectedLevel || courseLevel === selectedLevel;
                const matchesStatus = !selectedStatus || courseStatus === selectedStatus;
                
                if (matchesSearch && matchesLevel && matchesStatus) {
                    item.style.display = '';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Show/hide empty state
            if (visibleCount === 0 && coursesContainer) {
                emptyState.classList.remove('d-none');
            } else if (emptyState) {
                emptyState.classList.add('d-none');
            }
        }
        
        // Event listeners
        if (searchInput) {
            searchInput.addEventListener('keyup', filterCourses);
        }
        if (levelFilter) {
            levelFilter.addEventListener('change', filterCourses);
        }
        if (statusFilter) {
            statusFilter.addEventListener('change', filterCourses);
        }
    });
</script>
{% endblock %}