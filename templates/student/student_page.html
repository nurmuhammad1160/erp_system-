{% load static %}
<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student profile — {{ profile.user.get_full_name }}</title>

  <style>
    :root{
      --bg: #f6f9fc;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #1e40af; /* dark blue */
      --accent-2: #1e3a8a;
      --success: #10b981;
      --danger: #ef4444;
      --radius: 12px;
      --gap: 16px;
    }

    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}

    body{
      margin:0;
      background: linear-gradient(180deg, #f0f4ff 0%, var(--bg) 100%);
      color:#0f172a;
      padding:24px;
    }

    .container{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:28px;
      align-items:start;
    }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: 0 6px 20px rgba(16,24,40,0.06);
    }

    .profile-left{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .avatar-wrap{
      display:flex;
      gap:12px;
      align-items:center;
    }

    .avatar{
      width:110px;
      height:110px;
      border-radius:16px;
      object-fit:cover;
      border:4px solid rgba(30,64,175,0.08);
      background: #eef2ff;
    }

    .basic{
      flex:1;
    }

    .name{
      font-size:20px;
      font-weight:600;
      margin:0 0 6px 0;
    }
    .muted{
      color:var(--muted);
      font-size:13px;
      margin:0;
    }

    .meta{
      display:flex;
      gap:8px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    .chip{
      font-size:13px;
      padding:6px 10px;
      border-radius:999px;
      background:#eef2ff;
      color:var(--accent-2);
      border:1px solid rgba(30,64,175,0.06);
    }

    .input{
      width:100%;
      padding:8px 10px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:14px;
    }

    table td{
      padding:6px 8px;
      border-bottom:1px solid #f0f0f0;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- LEFT: avatar + basics -->
  <div class="card profile-left">
    <div class="avatar-wrap">
      {% if student.avatar %}
        <img src="{{ student.avatar.url }}" alt="Avatar" class="avatar" id="avatarImg">
      {% else %}
        <img src="{% static 'student_profile/default.jpg' %}" alt="Avatar" class="avatar" id="avatarImg">
      {% endif %}
      <div class="basic">
        <h2 class="name">{{ student.get_full_name }}</h2>
        <p class="muted">@{{ student.username }}</p>
        <div class="meta">
          <span class="chip">Status: {{ student.status }}</span>
          <span class="chip">Kirish: {{ student.join_date }}</span>
        </div>
      </div>
    </div>

    <hr />

    <div>
      <h3 style="margin:8px 0 6px 0;">Kontakt</h3>
      <p class="muted">Email</p>
      <p>{{ student.email|default:"—" }}</p>

      <p class="muted">Telefon</p>
      {% if profile.user.phone %}
        <p>{{ student.phone }}</p>
      {% else %}
        <p>—</p>
      {% endif %}

      <p class="muted">Ota-ona</p>
      <p>{{ student.parent_name|default:"—" }} — {{ student.parent_phone|default:"—" }}</p>
    </div>

    <div style="margin-top:12px;">
      <h3 style="margin:8px 0 6px 0;">Moliyaviy</h3>
      <p class="muted">Balans</p>
      <p>{{ student.balance }} UZS</p>
    </div>

    <div style="margin-top:12px;">
      <button id="editBtn" class="chip" style="cursor:pointer;border-radius:10px;">Profilni tahrirlash</button>
    </div>
  </div>

  <!-- RIGHT: details and editable form (hidden by default) -->
  <div class="card">
    <h2 style="margin-top:0;">Talaba haqida</h2>

    <div id="readView">
      <table style="width:100%;border-collapse:collapse">
        <tr>
          <td style="width:180px" class="muted">Guruh</td>
          <td>{{ student.group.name|default:"—" }}</td>
        </tr>
        <tr>
          <td class="muted">Ism</td>
          <td>{{ student.first_name|default:"—" }}</td>
        </tr>
        <tr>
          <td class="muted">Familiya</td>
          <td>{{ student.last_name|default:"—" }}</td>
        </tr>
        <tr>
          <td class="muted">Foydalanuvchi</td>
          <td>@{{ student.username }}</td>
        </tr>
        <tr>
          <td class="muted">Email</td>
          <td>{{ student.email|default:"—" }}</td>
        </tr>
        <tr>
          <td class="muted">Telefon</td>
          <td>{{ student.phone|default:"—" }}</td>
        </tr>
        <tr>
          <td class="muted">Ota-ona</td>
          <td>{{ student.parent_name|default:"—" }} — {{ student.parent_phone|default:"—" }}</td>
        </tr>
        <tr>
          <td class="muted">Kirish sanasi</td>
          <td>{{ student.join_date }}</td>
        </tr>
        <tr>
          <td class="muted">Balans</td>
          <td>{{ student.balance }}</td>
        </tr>
        <tr>
          <td class="muted">Holat</td>
          <td>{{ student.status }}</td>
        </tr>
      </table>
    </div>

    <!-- Editable form (POST to same view or other URL) -->
    <div id="editView" style="display:none;">
      <form method="post" enctype="multipart/form-data" id="profileForm">
        {% csrf_token %}
        <div style="display:flex;gap:12px;align-items:center;">
          <div style="flex:1;">
            <label class="muted">Ism</label>
            <input name="first_name" type="text" value="{{ student.first_name }}" class="input" />
          </div>
          <div style="flex:1;">
            <label class="muted">Familiya</label>
            <input name="last_name" type="text" value="{{ profile.user.last_name }}" class="input" />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label class="muted">Email</label>
          <input name="email" type="email" value="{{ profile.user.email }}" class="input" />
        </div>

        <div style="display:flex;gap:12px;margin-top:10px;">
          <div style="flex:1;">
            <label class="muted">Telefon</label>
            <input name="phone" type="text" value="{{ profile.user.phone }}" class="input" />
          </div>
          <div style="flex:1;">
            <label class="muted">Guruh</label>
            <input name="group" type="text" value="{{ profile.group.name|default:"" }}" class="input" />
            <small class="muted">(faqat ko‘rsatish uchun; backendda ID orqali bog‘lash kerak)</small>
          </div>
        </div>

        <div style="display:flex;gap:12px;margin-top:10px;align-items:center;">
          <div style="flex:1;">
            <label class="muted">Ota / Ona</label>
            <input name="parent_name" type="text" value="{{ profile.parent_name }}" class="input" />
          </div>
          <div style="flex:1;">
            <label class="muted">Ota-ona telefoni</label>
            <input name="parent_phone" type="text" value="{{ profile.parent_phone }}" class="input" />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label class="muted">Avatar yuklash</label>
          <input name="avatar" type="file" accept="image/*" id="avatarInput" class="input" />
        </div>

        <div style="display:flex;gap:8px;margin-top:14px;">
          <button type="submit" class="chip" style="cursor:pointer;">Saqlash</button>
          <button type="button" id="cancelEdit" class="chip" style="cursor:pointer;background:#fff;border:1px solid #eee;">Bekor qilish</button>
        </div>
      </form>
    </div>

  </div>
</div>

<script>
  (function(){
    const editBtn = document.getElementById('editBtn');
    const editView = document.getElementById('editView');
    const readView = document.getElementById('readView');
    const cancelBtn = document.getElementById('cancelEdit');
    const avatarInput = document.getElementById('avatarInput');
    const avatarImg = document.getElementById('avatarImg');

    if(editBtn){
      editBtn.addEventListener('click', function(){
        readView.style.display = 'none';
        editView.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
    if(cancelBtn){
      cancelBtn.addEventListener('click', function(){
        editView.style.display = 'none';
        readView.style.display = 'block';
      });
    }

    if(avatarInput && avatarImg){
      avatarInput.addEventListener('change', function(e){
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(ev){
          avatarImg.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      });
    }
  })();
</script>

</body>
</html>
