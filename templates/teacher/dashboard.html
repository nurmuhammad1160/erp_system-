{% extends 'base.html' %}
{% load static %}

{% block title %}O'qituvchi Dashboard - ERP Sistema{% endblock %}

{% block page_title %}O'qituvchi Dashboard{% endblock %}

{% block breadcrumb %}
<a href="{% url 'home' %}" class="text-decoration-none text-muted">Bosh sahifa</a> / 
<span>Dashboard</span>
{% endblock %}

{% block extra_css %}
<style>
    .stat-card {
        border-radius: 10px;
        padding: 25px;
        color: white;
        transition: transform 0.3s;
        height: 100%;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    
    .stat-card.purple {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .stat-card.pink {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .stat-card.cyan {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .stat-card.green {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    
    .stat-card h2 {
        font-size: 2.8rem;
        margin: 15px 0;
        font-weight: bold;
    }
    
    .card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        transition: all 0.3s;
    }
    
    .card:hover {
        box-shadow: 0 5px 20px rgba(0,0,0,0.12);
    }
    
    .group-item {
        border-left: 4px solid #667eea;
        padding: 15px;
        margin-bottom: 15px;
        background: #f8f9fa;
        border-radius: 5px;
        transition: all 0.3s;
    }
    
    .group-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }
    
    .submission-item {
        padding: 12px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .submission-item:last-child {
        border-bottom: none;
    }
    
    .submission-item:hover {
        background: #f8f9fa;
    }
    
    .badge-pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .quick-action-btn {
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border: 2px solid #e9ecef;
        transition: all 0.3s;
    }
    
    .quick-action-btn:hover {
        border-color: #667eea;
        background: #f8f9fa;
        transform: translateY(-2px);
    }
</style>
{% endblock %}

{% block content %}

<!-- Welcome Section -->
<div class="mb-4">
    <h2>Xush kelibsiz, {{ teacher.user.get_full_name|default:teacher.user.email }}! üë®‚Äçüè´</h2>
    <p class="text-muted">Bugungi sana: {% now "d F, Y" %}</p>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    
    <!-- Guruhlar -->
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card purple">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <p class="mb-0 opacity-75">Guruhlarim</p>
                    <h2>{{ groups.count }}</h2>
                    <small class="opacity-75">Faol guruhlar</small>
                </div>
                <i class="bi bi-people-fill" style="font-size: 3.5rem; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
    
    <!-- Talabalar -->
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card pink">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <p class="mb-0 opacity-75">Jami Talabalar</p>
                    <h2>{{ total_students }}</h2>
                    <small class="opacity-75">Barcha guruhlarda</small>
                </div>
                <i class="bi bi-person-badge-fill" style="font-size: 3.5rem; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
    
    <!-- Baholanmagan -->
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card cyan">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <p class="mb-0 opacity-75">Baholanmagan</p>
                    <h2>{{ unchecked_submissions }}</h2>
                    <small class="opacity-75">Topshiriqlar</small>
                </div>
                <i class="bi bi-inbox-fill" style="font-size: 3.5rem; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
    
    <!-- Reytingim -->
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card green">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <p class="mb-0 opacity-75">Reytingim</p>
                    <h2>{{ teacher.rating|floatformat:1 }}</h2>
                    <small class="opacity-75">5 ballik tizimda</small>
                </div>
                <i class="bi bi-star-fill" style="font-size: 3.5rem; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
    
</div>

<!-- Main Content Row -->
<div class="row">
    
    <!-- Left Column - Groups & Quick Actions -->
    <div class="col-lg-8">
        
        <!-- My Groups -->
        <div class="card mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-people"></i> Mening Guruhlarim</h5>
                <a href="{% url 'teacher:groups' %}" class="btn btn-sm btn-outline-primary">
                    Barchasini ko'rish <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            <div class="card-body">
                {% if groups %}
                    {% for group in groups|slice:":5" %}
                    <div class="group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="mb-1">{{ group.name }}</h6>
                                <p class="text-muted small mb-2">
                                    <i class="bi bi-book"></i> {{ group.course.title }}
                                </p>
                                <div class="d-flex gap-3">
                                    <small class="text-muted">
                                        <i class="bi bi-person"></i> {{ group.active_students_count }} talaba
                                    </small>
                                    <small class="text-muted">
                                        <i class="bi bi-calendar"></i> {{ group.start_date|date:"d.m.Y" }}
                                    </small>
                                    <span class="badge {% if group.status == 'active' %}bg-success{% elif group.status == 'finished' %}bg-secondary{% else %}bg-warning{% endif %}">
                                        {{ group.get_status_display }}
                                    </span>
                                </div>
                            </div>
                            <a href="{% url 'teacher:group_detail' group.pk %}" class="btn btn-sm btn-outline-primary">
                                Ko'rish
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                        <p class="mt-2">Sizga guruhlar tayinlanmagan</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Unchecked Submissions -->
        <div class="card">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-inbox"></i> Baholanmagan Topshiriqlar</h5>
                <a href="{% url 'teacher:unscored_homeworks' %}" class="btn btn-sm btn-outline-danger">
                    Barchasini ko'rish <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            <div class="card-body p-0">
                {% if unchecked_submissions > 0 %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Talaba</th>
                                    <th>Topshiriq</th>
                                    <th>Guruh</th>
                                    <th>Yuborilgan</th>
                                    <th>Amal</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Sample data - Bu yerda backend dan keladi -->
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 35px; height: 35px;">
                                                AK
                                            </div>
                                            <span>Alisher Karimov</span>
                                        </div>
                                    </td>
                                    <td>Python Asoslari - Dars 5</td>
                                    <td>A1</td>
                                    <td><small class="text-muted">2 soat oldin</small></td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary">
                                            <i class="bi bi-eye"></i> Ko'rish
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-check-circle" style="font-size: 3rem; color: #28a745;"></i>
                        <p class="mt-2 text-success">Barcha topshiriqlar baholangan! üéâ</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
    </div>
    
    <!-- Right Column - Quick Actions & Stats -->
    <div class="col-lg-4">
        
        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-lightning-charge"></i> Tez Harakatlar</h5>
            </div>
            <div class="card-body">
                
                <a href="{% url 'teacher:homework_create' %}" class="quick-action-btn d-block text-decoration-none text-dark">
                    <div class="d-flex align-items-center">
                        <div class="bg-primary text-white rounded p-2 me-3">
                            <i class="bi bi-plus-lg"></i>
                        </div>
                        <div>
                            <strong>Topshiriq Yaratish</strong><br>
                            <small class="text-muted">Yangi topshiriq qo'shish</small>
                        </div>
                    </div>
                </a>
                
                <a href="{% url 'teacher:attendance_create' %}" class="quick-action-btn d-block text-decoration-none text-dark">
                    <div class="d-flex align-items-center">
                        <div class="bg-success text-white rounded p-2 me-3">
                            <i class="bi bi-check2-square"></i>
                        </div>
                        <div>
                            <strong>Davomat Qayd Qilish</strong><br>
                            <small class="text-muted">Talabalar davomatini belgilash</small>
                        </div>
                    </div>
                </a>
                
                <a href="{% url 'teacher:materials' %}" class="quick-action-btn d-block text-decoration-none text-dark">
                    <div class="d-flex align-items-center">
                        <div class="bg-info text-white rounded p-2 me-3">
                            <i class="bi bi-file-earmark-arrow-up"></i>
                        </div>
                        <div>
                            <strong>Material Yuklash</strong><br>
                            <small class="text-muted">Dars materiallari qo'shish</small>
                        </div>
                    </div>
                </a>
                
                <a href="{% url 'teacher:grades' %}" class="quick-action-btn d-block text-decoration-none text-dark">
                    <div class="d-flex align-items-center">
                        <div class="bg-warning text-white rounded p-2 me-3">
                            <i class="bi bi-star"></i>
                        </div>
                        <div>
                            <strong>Baholar</strong><br>
                            <small class="text-muted">Talabalar baholari</small>
                        </div>
                    </div>
                </a>
                
            </div>
        </div>
        
        <!-- Today's Schedule -->
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-calendar3"></i> Bugungi Darslar</h5>
            </div>
            <div class="card-body">
                <!-- Sample schedule - Backend dan keladi -->
                <div class="border-start border-primary border-4 ps-3 mb-3">
                    <h6 class="mb-1">Python Asoslari</h6>
                    <small class="text-muted d-block">Guruh A1</small>
                    <small class="text-muted">
                        <i class="bi bi-clock"></i> 09:00 - 11:00
                    </small>
                </div>
                <div class="border-start border-success border-4 ps-3 mb-3">
                    <h6 class="mb-1">Web Development</h6>
                    <small class="text-muted d-block">Guruh B2</small>
                    <small class="text-muted">
                        <i class="bi bi-clock"></i> 14:00 - 16:00
                    </small>
                </div>
                <div class="text-center mt-3">
                    <a href="{% url 'teacher:schedule' %}" class="btn btn-sm btn-outline-primary">
                        To'liq Jadval
                    </a>
                </div>
            </div>
        </div>
        
    </div>
    
</div>

<!-- Performance Chart (Optional) -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Bu Oylik Statistika</h5>
            </div>
            <div class="card-body">
                <canvas id="performanceChart" height="80"></canvas>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Performance Chart
    const ctx = document.getElementById('performanceChart').getContext('2d');
    const performanceChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['1-hafta', '2-hafta', '3-hafta', '4-hafta'],
            datasets: [{
                label: 'Baholangan Topshiriqlar',
                data: [12, 19, 15, 25],
                borderColor: 'rgb(102, 126, 234)',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                tension: 0.4
            }, {
                label: 'Davomat Qayd Qilish',
                data: [8, 12, 10, 15],
                borderColor: 'rgb(67, 233, 123)',
                backgroundColor: 'rgba(67, 233, 123, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}